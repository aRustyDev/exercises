# Baseband Exploitation

## Example 1: OffensiveCon 2023 & 2024

In the ~15 years since the launch of the Osmocom and OpenBTS projects (2008), "Fuzzing the Phone in your Phone" (2009), and "All Your Basebands Are Belong To Us" (2010), baseband hacking has gone from a research novelty to an IRL threat. But also during this time, the gap between the challenges addressed by public research demonstrations and operational use has started growing.

In this course, students will learn through hands-on exercises how to setup and operate multiple generations of cellular networks using open source components and software-defined radios, how to modify their code for generating customized traffic via programming interfaces and use them for mobile attacks, and how to approach the static and dynamic baseband firmware analysis and reverse engineering of the target devices.

The training will cover the basics of cellular networks and baseband operating systems from a security standpoint and then focus on approaches, techniques, and tools for finding and exploiting baseband vulnerabilities. We will place an emphasis on real-life usage scenarios and the challenges associated with developing, maintaining, and executing full baseband exploit chains.

### Objectives

#### 2025

- Basic understanding of cellular networks
- Understanding of the interaction between baseband and base stations
- Understanding of typical baseband architectures
- Ability to identify and exploit vulnerabilities in the baseband
- Understanding the interaction between cellular processors and application processors
- Reverse engineering embedded firmware

#### 2024

- Learning the fundamentals of cellular networks from 2G to 5G
- Running networks and engaging with basebands via custom cellular traffic
- Understanding baseband OS internals from a security perspective
- Reverse engineering baseband OS firmwares
- Finding and analyzing remote baseband vulnerabilities and baseband pivot vulnerabilities
- Debugging execution flows and developing exploits

### Days 1-4

#### Introduction to Cellular Networks

- The GSM protocol
- The 3G protocol
- The 4G Protocol
- The CDMA path of cellular protocols
- Cellular protocols security, shortcomings and attack surfaces, motivations and impact
- Exercises: Installing and operating 2G/4G/5G networks using Osmocom, srsRAN, open5GS

#### Research Environment Setup

- Installing and setting up OpenBSC
- Programming your own SIM card
- Installing and setting up srsLTE
- Testing communications and modifying OpenBSC and srsLTE
- Extracting the firmware image of the target and loading into Ghidra / IDA
- Reverse engineering the target to identify cellular stack code
- Debugging the target

#### Vulnerability Identification and Exploitation

- Bug hunting and exploitation (GSM)
- Bug hunting and exploitation (LTE)
- Exploring possibilities of a compromised baseband
- Pivoting to the application processors

#### Finding Baseband vulnerabilities

- Baseband reverse engineering: firmware extraction, RTOS analysis
- Building tooling and automation with Ghidra
- Identifying the attack surfaces within the binary, analyzing bugs
- Exercises: Spotting and triaging tulnerabilities, finding ways for debugging

#### Exploiting Baseband vulnerabilities

- Deep-dive of baseband OS internals, hardenings, and exploit mitigations
- Fundamentals of baseband exploitation, building exploit primitives from bugs
- Exercises: Exploiting an N-day remote baseband vulnerability

#### Pivoting from Baseband to Android

- Using baseband rce for a chain: challenges and techniques for writing robust exploits
- Attack surfaces for baseband pivot vulnerabilities
- Android exploit development with a pivot attack vector
- Exercises: Exploiting an N-day baseband pivot vulnerability

### Pre-requisites

- Familiarity with the ARM architecture
- Familiarity with memory corruption/safety vulnerabilities and exploitation
- Be comfortable with C and ARM assembly
- Basic reverse engineering skills
- Experience in reverse engineering, RISC-like assembly (ideal: experience with Ghidra, ARM)
- Experience in working with Android OS
- IDA license if you prefer to use that over Ghidra
- Installed utilities: ssh, adb, lxd (https://ubuntu.com/lxd/install), ghidra 10.3.3

## Example 2: hexacon 2024 / RingZer0 2021 / REverse 2025

### Abstract

Baseband exploitation is often considered the cream of the offensive security field. In the last decade, only a handful of such exploits were publicly released. As a result, many researchers view the ability to silently achieve code execution on a victim's device by emulating a GSM or LTE base station as a difficult objective.

In reality, baseband exploitation is much easier than expected. By following a simple list of steps, a baseband platform can be quickly opened up for research, debugging and exploitation. In this course, students will learn our systematic approach to baseband research - from setting up a fake base station using SDR and open-source BTS software, to achieving initial debugging abilities using our embedded hooking framework, and finally reverse engineering the relevant protocols, hunting for bugs and exploiting them.

By the end of this heavily hands-on course, students will become familiar with two extremely common baseband platforms, Shannon and Mediatek, gain the skills to debug these and other baseband platforms, and learn about previously discovered bugs in basebands, and how they have been exploited.

NOTE: Since this is a remote training, usage of equipment will be done via 1-on-1 sessions with the trainer which will be scheduled throughout the duration of the course. The students will connect to a remote machine, control the equipment via SSH, and direct the instructor to conduct any physical handling of the equipment.

Each student will be provided with a Software Defined Radio (SDR) board to emulate a base station, and a modern mobile phone to serve as a target.

### Objectives

#### Hexacon / REverse

Understanding, loading, and analysing the RTOS baseband firmware
Navigating and understanding 3GPP protocols
Understanding 2G, 3G, 4G and 5G attack surfaces
Setting up a base station (BTS) and modifying its code

#### RingZer0

Achieving initial read/write primitives
Building a baseband debugger
Basic familiarity with 3GPP protocols, in particular GSM and GPRS
Understanding the relevant GSM and GPRS attack surfaces

#### Shared

Understanding communication processors at the architecture level
Extracting baseband firmware for a device
Exploitation tricks in the baseband
Reverse engineering the code - methods and tricks
Bug hunting - methods, tips, and previously discovered bugs

### Days 1-4

#### Introduction, initial analysis and debugging

- Introduction to communication processors (CP):
    - The evolution and challenges of communication systems
    - Baseband processors: An architecture overview
    - CP architectures: Broadcom, Qualcomm, MediaTek, Samsung, Intel
- Code extraction and initial analysis (both Shannon and MediaTek)
    - Challenges of baseband code extraction
    - Getting the firmware
    - Initial analysis: Parsing the firmware header
    - Loading into IDA: Base addresses and program segmentation
- Understanding baseband Real Time Operating Systems (RTOS)
    - Data structures and IPC
    - Memory permissions and mappings
    - Mapping the attack surface
    - Identifying functions and symbols in the code and writing a function mapping script
    - Extracting debug strings and parsing them to name functions in the IDB
- Achieving initial read primitives, basic code analysis 
    - Bypassing code signing in Shannon                  
    - AT commands as a Shannon attack surface            
- Debugging:
    - Obtaining memory dumps
    - Conditions for building a debugger
    - Getting RWX permissions
    - Hooks: Using our multi-platform hooking framework
    - Building a debugger

#### Cellular protocols and static analysis

- Introduction to GSM, GPRS, UMTS, 2G, 3G, 4G and 5G:
    - Guide to the relevant 3GPP protocols
    - Working with the specifications
    - Determining the protocol attack surface
    - Real time packet captures, analysing a sample PCAP
- Shannon: Static analysis and an architecture overview:
    - Tasks, memory management and code structure
    - Debugging functionality
    - Samsung IPC: Talking to the Application Processor
    - The Platform Abstraction Layer and the HAL
- MediaTek: A comparison with Shannon:
    - Nucleus OS: implementation in MediaTek
    - Debugging the MediaTek baseband
    - Interaction with the AP
- Setting up a rogue BTS:
    - Getting started BTS source code
    - Making phone calls and sending SMS over your own network

#### Finding bugs in Shannon and MediaTek

- 2G and 3G sub-protocols:
    - Reverse engineering of a protocol handler in Shannon and in MediaTek
    - Adapting BTS source code to run with GPRS and a primer on the protocol
- The CC, SS, SMS and SM protocols:
    - Packet structure and PCAP analysis
    - Full reversing of a CC handler function in Shannon and in MediaTek
    - Adapting OpenBTS to run with GPRS and a primer on the protocol
- Vulnerability research in 4G and 5G (UMTS and LTE):
    - The additional complexities of setting up an eNodeB
    - Getting the environment up and running
    - Working with mutual authentication
    - Enumerating pre and post authentication attack surfaces
- Finding Shannon bugs:
    - Enumerating Over-The-Air (OTA) radio packet parsers
    - Guiding the students towards finding a Shannon bug presented at Pwn2Own 2018
    - Guiding the students towards finding a recent Shannon bug that was silently patched
- Finding MediaTek bugs:
    - Guiding the students towards finding a GPRS bug in MediaTek (DoS)
    - Analysing the bug using the adapted hooking framework
    - Opening related attack surfaces in MediaTek

#### Exploiting a Shannon n-day

- Modifying BTS source code to deliver the exploit payload
- Exploit primitives
    - Restoring execution after a Shannon stack overflow – resuming the message parsing loop
    - Exploiting heap overflows in Shannon OS
    - Analysing the stack and heap for secondary exploitation primitives
    - Challenges/exploit mitigations
- Achieving code execution:
    - Developing a proof of concept (PoC)
    - Using ROP for a full exploit
    - Loading the initial shellcode stub into global memory
    - Building a custom bridgehead – receiving the main payload over the air
    - Second stage: Modifying the system’s behaviour in order to capture traffic or escalate to the AP
- Baseband emulation for vulnerability research
- Adapting the exploit to different ROMs
    - Resolving symbols in different firmware versions
    - Identifying the target’s firmware version
    - Customizing a payload to the targeted firmware version
- Escalating to the Application Processor (AP) and Android - an introduction

### Pre-requisites

- Ability to read and write C and Python source code
- Good reverse engineering knowledge
- Recommended: Familiarity with ARM assembly
- IDA Pro with ARM Architecture (ideally latest version, minimum 7.6 SP1)
- Hex-Rays 32-bit ARM Decompiler OPTIONAL BUT HIGHLY RECOMMENDED
- Linux / Windows / Mac OS desktop operating systems
- VMWare (all platforms) or KVM (Linux only, if you prefer it to VMWare)
- Administrator / root access

## additional links

- [secwest](https://www.secwest.net/presentations-2024/there-will-be-bugs-exploiting-basebands-in-radio-layer-two)
- [taszk labs](https://labs.taszk.io/articles/post/full_chain_bb_part1/)
- [hardwear.io 1st training](https://hardwear.io/the-hague-2018/training/practical-baseband-exploitation.php)
- [awesome list](https://github.com/lololosys/awesome-baseband-research) 
